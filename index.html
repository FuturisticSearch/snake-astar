<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blue Snake AI</title>
<style>
    body {
        display: flex;
        flex-direction: column;
        align-items: center;
        background: #222;
        font-family: Arial, sans-serif;
        color: #fff;
        margin: 0;
        padding: 20px;
    }
    canvas {
        background: #111;
        border: 3px solid #00f;
        border-radius: 8px;
        margin: 20px 0;
    }
    h1 {
        margin: 10px 0;
    }
    label, button {
        margin: 10px;
        font-size: 1.2em;
    }
    button {
        padding: 8px 16px;
        cursor: pointer;
        background: #00f;
        color: #fff;
        border: none;
        border-radius: 5px;
    }
    button:hover {
        background: #0055ff;
    }
</style>
</head>
<body>
<h1>Blue Snake AI</h1>
<label><input type="checkbox" id="useAI"> Use AI</label>
<canvas id="snake" width="608" height="608"></canvas>
<h1>Score: <span id="score">0</span></h1>
<button id="playAgain">Play Again</button>

<script>
// ---------------- Setup ----------------
const cvs = document.getElementById("snake");
const ctx = cvs.getContext("2d");
const box = 32;

let snake, food, score, d, aiDirection, game;
const useAI = document.getElementById("useAI");

// ---------------- Sounds ----------------
let dead = new Audio("audio/dead.mp3");
let eat = new Audio("audio/eat.mp3");
let up = new Audio("audio/up.mp3");
let rightS = new Audio("audio/right.mp3");
let leftS = new Audio("audio/left.mp3");
let downS = new Audio("audio/down.mp3");

// ---------------- Initialize ----------------
function initGame(){
    snake = [{ x: 9*box, y: 10*box }];
    food = spawnFood();
    score = 0;
    d = "RIGHT";
    aiDirection = "RIGHT";
    if(game) clearInterval(game);
    game = setInterval(draw, 150);
}

function spawnFood(){
    let f;
    do {
        f = { x: Math.floor(Math.random()*17+1)*box, y: Math.floor(Math.random()*17+1)*box };
    } while(snake.some(seg => seg.x===f.x && seg.y===f.y));
    return f;
}

// ---------------- Controls ----------------
document.addEventListener("keydown", function(event){
    if(useAI.checked) return;

    let key = event.keyCode;
    let head = snake[0];
    let newHead = {x: head.x, y: head.y};

    if(key == 37 && d!="RIGHT") newHead.x -= box;
    else if(key == 38 && d!="DOWN") newHead.y -= box;
    else if(key == 39 && d!="LEFT") newHead.x += box;
    else if(key == 40 && d!="UP") newHead.y += box;
    else return;

    // Prevent crashing into itself manually
    if(!snake.some(seg => seg.x === newHead.x && seg.y === newHead.y)) {
        d = (key==37)?"LEFT":(key==38)?"UP":(key==39)?"RIGHT":"DOWN";
        if(d=="LEFT") leftS.play();
        if(d=="UP") up.play();
        if(d=="RIGHT") rightS.play();
        if(d=="DOWN") downS.play();
    }
});

// ---------------- Collision ----------------
function collision(head, array){
    return array.some(seg => seg.x===head.x && seg.y===head.y);
}

// ---------------- AI Logic ----------------
function getAIMove(){
    if(!useAI.checked) return d;
    let head = snake[0];
    let moves = [];
    if(head.x-box>=0 && !collision({x:head.x-box, y:head.y}, snake)) moves.push("LEFT");
    if(head.x+box<18*box && !collision({x:head.x+box, y:head.y}, snake)) moves.push("RIGHT");
    if(head.y-box>=0 && !collision({x:head.x, y:head.y-box}, snake)) moves.push("UP");
    if(head.y+box<18*box && !collision({x:head.x, y:head.y+box}, snake)) moves.push("DOWN");
    moves.sort((a,b)=> distanceToFood(a)-distanceToFood(b));
    return moves[0] || d;
}

function distanceToFood(direction){
    let head = snake[0];
    let nx=head.x, ny=head.y;
    if(direction==="LEFT") nx-=box;
    if(direction==="RIGHT") nx+=box;
    if(direction==="UP") ny-=box;
    if(direction==="DOWN") ny+=box;
    return Math.abs(nx-food.x)+Math.abs(ny-food.y);
}

// ---------------- Draw ----------------
function draw(){
    ctx.fillStyle = "#111";
    ctx.fillRect(0,0,cvs.width,cvs.height);

    for(let i=0;i<snake.length;i++){
        ctx.fillStyle = i===0?"blue":"lightblue";
        ctx.fillRect(snake[i].x,snake[i].y,box,box);
        ctx.strokeStyle="darkblue";
        ctx.strokeRect(snake[i].x,snake[i].y,box,box);
    }

    ctx.fillStyle = "red";
    ctx.fillRect(food.x,food.y,box,box);

    aiDirection = getAIMove();
    d = aiDirection;

    let snakeX = snake[0].x;
    let snakeY = snake[0].y;

    if(d==="LEFT") snakeX-=box;
    if(d==="RIGHT") snakeX+=box;
    if(d==="UP") snakeY-=box;
    if(d==="DOWN") snakeY+=box;

    if(snakeX===food.x && snakeY===food.y){
        score++;
        eat.play();
        food = spawnFood();
    } else {
        snake.pop();
    }

    let newHead = {x:snakeX, y:snakeY};
    if(snakeX<0 || snakeX>=18*box || snakeY<0 || snakeY>=18*box || collision(newHead,snake)){
        clearInterval(game);
        dead.play();
        return;
    }

    snake.unshift(newHead);
    document.getElementById("score").textContent = score;
}

// ---------------- Play Again ----------------
document.getElementById("playAgain").addEventListener("click", initGame);

// ---------------- Start Game ----------------
initGame();
</script>
</body>
</html>
